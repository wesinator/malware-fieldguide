#!/usr/bin/env python3
import json
#import re

from malware_object import Malware

# https://github.com/fhightower/ioc-finder/blob/master/ioc_finder/data_lists.py
import data_lists


def process_iocfinder_lists():
    malware_objs = []
    names = []

    for item in (data_lists.malware_name_regexes + data_lists.malpedia_malware_name_regexes):
        #print(item)
        #regex = re.compile(item)
        name = item
        aliases = []

        malpedia_prefix = "(b106-)?"
        if item.startswith(malpedia_prefix):
            name = item.replace(malpedia_prefix, "")
        elif item.startswith("b106-"):
            name = item.replace("b106-", "")
        
        if name.startswith("("):
            subwords = name[1:-1].split("|")
            name = subwords[0]
            for word in subwords:
                if word != name:
                    aliases.append(word)
        names.append(name)


        malware_objs.append(
            Malware(name,
                    item,
                    aliases,
                    references=["https://github.com/fhightower/ioc-finder/blob/master/ioc_finder/data_lists.py"]
            ).__dict__
        )

    return malware_objs


if __name__ == "__main__":
    ioc_finder_mal = process_iocfinder_lists()

    iocfinder_out = json.dumps(ioc_finder_mal, indent=2)

    with open("malware.json", "w") as json_out:
        json_out.write(iocfinder_out)
